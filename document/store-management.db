CREATE DATABASE IF NOT EXISTS TIRE_STORE_ALTER;

USE TIRE_STORE_ALTER;

CREATE TABLE PRODUCT (
	ID BINARY(16) NOT NULL,
    NAME VARCHAR(100),
    TYPE VARCHAR(100),
    SIZE VARCHAR(10),
    BRAND VARCHAR(100),
    PATTERN VARCHAR(50),
    IMAGE_PATH VARCHAR(100),
    PRICE DECIMAL(13, 4) NOT NULL,
    QUANTITY_REMAIN INT NOT NULL,
    DESCRIPTION VARCHAR(512),
    CREATED_DATE DATETIME,
    CREATED_BY BINARY(16),
    MODIFY_DATE DATETIME,
    MODIFY_BY BINARY(16),
    CONSTRAINT PK_PRODUCT PRIMARY KEY (ID)
);


CREATE TABLE PRICE_FLUCTUATION (
    ID BINARY(16) NOT NULL,
    PRODUCT_ID BINARY(16) NOT NULL,
    DATE DATETIME,
    CHANGED_IMPORT_PRICE DECIMAL(13, 4) NOT NULL,
    CURRENT_IMPORT_PRICE DECIMAL(13, 4),
    CHANGED_PRICE DECIMAL(13, 4) NOT NULL,
    CURRENT_PRICE DECIMAL(13, 4),
    CONSTRAINT PK_PRICE_FLUCTUATION PRIMARY KEY (ID)
);


CREATE TABLE ACCOUNT (
	ID BINARY(16),
    USERNAME VARCHAR(50),
    PASSWORD VARCHAR(50),
    SALT CHAR(32),
    CONSTRAINT PK_ACCOUNT PRIMARY KEY (ID)
);

CREATE TABLE OPERATION_HISTORY (
	ID BINARY(16),
    ACCOUNT_ID BINARY(16),
    ACTION VARCHAR(50),
    MESSAGE VARCHAR(256),
    ACTION_DATE DATETIME,
    CONSTRAINT PK_OPS_HISTORY PRIMARY KEY (ID),
    CONSTRAINT FK_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID)
);

CREATE TABLE TX_REPORT (
	ID BINARY(16),
    ACCOUNT_ID BINARY(16),
    PRODUCT_ID BINARY(16),
    CREATE_TIME DATETIME,
    UPDATE_TIME DATETIME,
    ACTION VARCHAR(20),
    QUANTITY_UPDATE INT,
    PRICE_UPDATE DECIMAL(13, 4),
    CONSTRAINT PK_TX_REPORT PRIMARY KEY (ID),
    CONSTRAINT FK_ACCOUNT_TX_HISTORY FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID),
    CONSTRAINT FK_PRODUCT_TX_HISOTRY FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(ID)
);

CREATE TABLE CUSTOMER (
	ID BINARY(16),
    FULL_NAME VARCHAR(50),
    ADDRESS VARCHAR(512),
    BANK_ACCOUNT_NUMBER VARCHAR(20),
    TAX_CODE VARCHAR(20),
    CONSTRAINT PK_CUSTOMER PRIMARY KEY (ID)
);

CREATE TABLE INVOICE (
	ID BINARY(16),
    INVOICE_NO INT,
    EXPORT_DATE DATETIME,
    DETAIL VARCHAR(512),
    TOTAL DECIMAL(13, 4),
	STATUS INT,
    ACCOUNT_ID BINARY(16),
    CUSTOMER_ID BINARY(16),
    CONSTRAINT PK_INVOICE PRIMARY KEY (ID),
    CONSTRAINT FK_ACCOUNT_INVOICE FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID),
    CONSTRAINT FK_CUSTOMER_INVOICE FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(ID)
);

CREATE TABLE INVOICE_LINE (
	ID BINARY(16),
    QUANTITY INT,
    TOTAL DECIMAL(13, 4),
    DESCRIPTION VARCHAR(256),
    INVOICE_ID BINARY(16),
	CONSTRAINT PK_INVOICE_LINE PRIMARY KEY (ID),
    CONSTRAINT FK_INVOICE_INVOICE_LINE FOREIGN KEY (INVOICE_ID) REFERENCES INVOICE(ID)
);

CREATE TABLE EXPORT_UNIT(
    ID BINARY(16),
    PRICE_FLUCTUATION_ID BINARY(16),
    WARRANTY_CODE VARCHAR(50),
    TYPE VARCHAR(50),
    EXPORT_PRICE DECIMAL(13, 4),
    QUANTITY INT,
    BILLING BOOL,
    EXPORT_DATETIME DATETIME,
    INVOICE_LINE_ID BINARY(16),
    CONSTRAINT PK_EXPORT_UNIT PRIMARY KEY (ID),
    CONSTRAINT FK_EXPORT_UNIT_INVOICE_LINE FOREIGN KEY (INVOICE_LINE_ID) REFERENCES INVOICE_LINE(ID),
    CONSTRAINT FK_EXPORT_UNIT_PRICE_FLUCTUATION FOREIGN KEY (PRICE_FLUCTUATION_ID) REFERENCES PRICE_FLUCTUATION(ID)
);

























